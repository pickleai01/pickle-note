# v2.1.0 계획 — 에러 핸들링 개선

> 상태: 대기 (v2.0.0 심사 통과 후 착수)
> 우선순위: 최우선
> 근거: Perplexity/Grok 리뷰 공통 지적 — "첫 실패로 70% 이탈"

---

## 현재 문제

실패 시 동작:
```
오버레이 blur + 스피너 → catch 블록 → sendStatus('오류: ...') → hideOverlay(0)
→ 오버레이 즉시 사라짐 → 사용자는 뭘 해야 하는지 모름
```

- 에러 메시지가 팝업 상태바에만 표시 (팝업 닫으면 사라짐)
- 오버레이가 바로 사라져서 실패 상황 인지 어려움
- 수동 복구 가이드 없음
- 재시도 수단 없음 (팝업 다시 열어서 처음부터)

---

## 구현 범위 (과잉 엔지니어링 방지)

### 할 것
1. 오버레이에 에러 상태 전용 UI (빨간 아이콘 + 실패 단계 + 원인 + 수동 안내)
2. "다시 시도" 버튼 (오버레이에서 바로 재시도)
3. "수동으로 하기" 링크 (NotebookLM 탭 포커스)
4. 5단계별 한국어 실패 메시지 매핑

### 안 할 것 (사용자 100명 이상 시 재검토)
- 스크린샷 자동 첨부 (Chrome 확장 기술적 제한)
- 서버 자동 보고 (서버 없음)
- 카톡 채널 자동 전송
- 진행 바 색상 전환 (효과 대비 작업량 큼)

---

## 5단계별 에러 메시지 설계

### 1단계: NotebookLM 탭 열기 실패

| 원인 | 메시지 |
|------|--------|
| 팝업 차단 | "NotebookLM 탭을 열 수 없습니다. 브라우저 팝업 차단을 해제해주세요." |
| 네트워크 | "인터넷 연결을 확인해주세요." |
| incognito | "시크릿 모드에서는 동작하지 않을 수 있습니다. 일반 창에서 시도해주세요." |

복구: "다시 시도" 버튼

### 2단계: 소스 추가 버튼 못 찾음

| 원인 | 메시지 |
|------|--------|
| 셀렉터 실패 | "소스 추가 버튼을 찾을 수 없습니다." |
| UI 변경 | "NotebookLM이 최근 업데이트됐을 수 있습니다." |

복구:
```
수동으로 하기:
1. NotebookLM에서 '+' 버튼 클릭
2. '웹사이트' 선택
3. YouTube URL 붙여넣기
```

### 3단계: URL 입력 실패

| 원인 | 메시지 |
|------|--------|
| 입력창 미준비 | "URL을 자동으로 입력하지 못했습니다. 입력창이 아직 준비되지 않았습니다." |
| setter 실패 | "NotebookLM 입력 방식이 변경되었을 수 있습니다." |

복구: "YouTube URL이 클립보드에 복사되었습니다. 직접 붙여넣기 해주세요." + "다시 시도" 버튼

### 4단계: 삽입 버튼 실패

| 원인 | 메시지 |
|------|--------|
| 버튼 못 찾음 | "소스를 등록하지 못했습니다." |
| 소스 한도 초과 | "NotebookLM 소스 개수 제한에 도달했을 수 있습니다." |

복구: "'기존 소스 삭제' 옵션을 켜고 다시 시도해보세요." + "다시 시도" 버튼

### 5단계: 프롬프트 전송 실패

| 원인 | 메시지 |
|------|--------|
| 채팅 입력 못 찾음 | "프롬프트를 입력할 수 없습니다. NotebookLM이 소스를 처리 중일 수 있습니다." |
| 전송 버튼 실패 | "전송 버튼을 찾지 못했습니다." |
| API 지연 | "NotebookLM 서버가 바쁩니다. 잠시 후 다시 시도해주세요." |

복구: "NotebookLM에서 직접 '전송' 버튼을 눌러보세요." + "다시 시도" 버튼

---

## 구현 방식

### 오버레이 에러 UI

```
기존 오버레이 재활용, 에러 시 상태 변경:
- 스피너 → 빨간 X 아이콘
- 텍스트: "[N/5] 실패 — {원인}"
- 서브텍스트: "{수동 복구 안내}"
- 버튼 2개: "다시 시도" / "수동으로 하기"
- "숨기기" 버튼 유지
```

### 코드 변경 예상

**content.js**:
- `showErrorOverlay(step, errorType)` 함수 추가
- 5단계별 에러 메시지 맵 객체
- "다시 시도" 버튼 → `runAutomation` 재호출
- "수동으로 하기" → 오버레이 해제

**기존 `withRetry`**:
- 2회 자동 재시도 (현재 동작 유지)
- 최종 실패 시 `showErrorOverlay` 호출 (현재는 `throw`)

### 변경 파일
- `content.js` — 에러 오버레이 UI + 메시지 맵
- `selectors.js` — 변경 없음 예상
- `popup.js` — 변경 없음 예상

---

## 체크리스트

- [ ] v2.0.0 심사 통과 확인
- [ ] `showErrorOverlay` 함수 구현
- [ ] 5단계 에러 메시지 맵 작성
- [ ] "다시 시도" 버튼 동작
- [ ] "수동으로 하기" 링크 동작
- [ ] 클립보드 URL 복사 (3단계 실패 시)
- [ ] manifest.json version → "2.1.0"
- [ ] ZIP 재생성 + 스토어 업데이트
- [ ] DEVELOPMENT_HISTORY.md 업데이트
